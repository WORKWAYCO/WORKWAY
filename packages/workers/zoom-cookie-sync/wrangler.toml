name = "zoom-cookie-sync"
account_id = "5c3e9cf4d55ce171b844fad0931607f9"  # Half Dozen
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Browser Rendering API for Zoom scraping
browser = { binding = "BROWSER" }

# Custom domain - outcome-focused URL (Zuhandenheit)
# Users see "meetings" (their outcome), not "zoom" (the tool)
# custom_domains auto-creates DNS records (unlike routes)
routes = [
  { pattern = "meetings.workway.co", custom_domain = true }
]

# Durable Objects for per-user cookie storage
[[durable_objects.bindings]]
name = "USER_SESSIONS"
class_name = "UserSession"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["UserSession"]

# Environment variables (set via wrangler secret put)
# UPLOAD_SECRET - Secret for cookie upload authorization (shared across users)
# API_SECRET - Secret for API calls from workflows

# Cron trigger: Refresh cookies every 6 hours to keep sessions alive
# Runs at 0:00, 6:00, 12:00, 18:00 UTC
[triggers]
crons = ["0 */6 * * *"]

[vars]
# Public configuration - canonical URL
WORKER_URL = "https://meetings.workway.co"
