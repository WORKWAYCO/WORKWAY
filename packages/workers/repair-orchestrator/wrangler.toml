name = "repair-orchestrator"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Durable Object binding
[[durable_objects.bindings]]
name = "REPAIR_ORCHESTRATOR"
class_name = "RepairOrchestrator"
script_name = "repair-orchestrator"

# Durable Object migration
[[migrations]]
tag = "v1"
new_classes = ["RepairOrchestrator"]

# Queue consumer for repair-queue
[[queues.consumers]]
queue = "repair-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "repair-queue-dlq"

# Workflow binding - references the repair-agent workflow
[[workflows]]
binding = "REPAIR_AGENT_WORKFLOW"
name = "repair-agent"
class_name = "RepairAgent"
script_name = "repair-agent"

# Secrets (set via wrangler secret put)
# - ANTHROPIC_API_KEY: Claude API key
# - GITHUB_TOKEN: GitHub token for PR creation

# Routes (optional, for direct access)
# routes = [
#   { pattern = "repair-orchestrator.workway.co/*", zone_name = "workway.co" }
# ]
