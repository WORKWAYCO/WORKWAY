name = "workway-construction-mcp"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]
account_id = "5c3e9cf4d55ce171b844fad0931607f9"

# Keep workers.dev URL for development/testing
workers_dev = true

# Custom domain for production
routes = [
  { pattern = "construction.mcp.workway.co", custom_domain = true }
]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "workway-construction"
database_id = "79db6a83-9368-4d8b-8c99-9070329a3c6d"

# KV for OAuth tokens and cache
[[kv_namespaces]]
binding = "KV"
id = "a5fa4c4a6c5c46739cc3e8ed841cb237"

# Durable Objects for workflow state
[[durable_objects.bindings]]
name = "WORKFLOW_STATE"
class_name = "WorkflowState"

# Durable Object for Procore rate limiting (3600 req/min)
[[durable_objects.bindings]]
name = "PROCORE_RATE_LIMITER"
class_name = "ProcoreRateLimiter"

[[migrations]]
tag = "v1"
new_classes = ["WorkflowState"]

[[migrations]]
tag = "v2"
new_classes = ["ProcoreRateLimiter"]

# Workers AI for Intelligence Layer Skills
[ai]
binding = "AI"

# Analytics Engine for Agent Observability Metrics
[[analytics_engine_datasets]]
binding = "AGENT_METRICS"
dataset = "workway_agent_metrics"

# Environment variables
[vars]
ENVIRONMENT = "development"
# AI Gateway ID for LLM observability (token tracking, cost monitoring, caching)
AI_GATEWAY_ID = "workway-mcp"

# Distributed Tracing Configuration
# Sampling rate: 0.0 to 1.0 (default 0.1 = 10% of requests traced)
TRACE_SAMPLING_RATE = "0.1"

# Optional: OpenTelemetry export to external systems
# Uncomment and set via wrangler secret put or [vars] for non-sensitive endpoints
# OTEL_EXPORTER_URL = "https://your-otel-collector.com/v1/traces"

# Optional: Langfuse host for AI observability
# LANGFUSE_HOST = "https://cloud.langfuse.com"

# Secrets (set via wrangler secret put)
# PROCORE_CLIENT_ID
# PROCORE_CLIENT_SECRET
# COOKIE_ENCRYPTION_KEY
# CLOUDFLARE_ACCOUNT_ID  # Required for AI Gateway routing
# LANGFUSE_PUBLIC_KEY    # Optional: Langfuse public key
# LANGFUSE_SECRET_KEY    # Optional: Langfuse secret key
